对两个标的（如股票、期货、外汇等）走势进行相关性分析，单纯看一个“相关系数”往往是不够的。专业的分析通常会从以下 **6 个维度（角度）** 展开，由浅入深，从静态到动态，从统计到逻辑：

## 复权方式

抱歉，刚才理解偏了。**复权方式（Adjustments）** 对于走势相关性分析来说，是**最基础且最致命**的一个预处理环节。

如果不进行复权处理，或者选错了复权方式，你算出来的任何相关性系数（Correlation）、Beta 值或协整关系都可能是**虚假的**。

针对“复权”，以下是针对相关性分析的详细建议：

### 1. 为什么必须“复权”？（核心风险）
如果不复权（使用原始价格），上市公司发生**分红、送股、拆股**时，股价会因为除权出现“断崖式下跌”。

* **对相关性分析的破坏：** 假设标的 A 进行了 10 送 10 的拆股，股价瞬间从 100 元变成 50 元（跌幅 50%）。
* **后果：** 你的算法会认为 A 发生了暴跌，而标的 B 没有动。这会导致两者的**相关系数瞬间骤降**，甚至出现负相关。但这完全是数学幻觉，A 的实际价值并没有波动。

### 2. 前复权 vs. 后复权：选哪个？

在做相关性分析时，**坚决不能用“不复权”数据**。至于用“前复权”还是“后复权”，取决于你的计算周期和具体算法：

#### A. 前复权 (Forward Adjustment) —— **看盘、短期分析首选**
* **定义：** 以**当前**价格为基准，把历史价格往下打折。
* **优点：** 现在的价格就是盘面上看到的价格（比如茅台 1800），符合直觉，画图给别人看时容易理解。
* **缺点（致命）：** 如果时间跨度非常长（比如 20 年），且分红非常多，历史上的“前复权价格”可能会被减成**负数**。
    * *数学灾难：* 一旦价格变成负数，你无法计算 **对数收益率** $\ln(P_t/P_{t-1})$，因为真数不能为负。这会导致量化模型直接报错。
* **适用场景：**
    * **目测观察：** 把两个 K 线图叠在一起看走势。
    * **短期窗口：** 分析最近 1-3 年的相关性。

#### B. 后复权 (Backward Adjustment) —— **量化分析、长期回测首选**
* **定义：** 以**上市第一天**（或某个历史起点）的价格为基准，把现在的价格往上抬。
* **优点：** 保证价格永远为正数，永远能够计算收益率。它真实反映了“如果你从第一天持有到现在”的累计复利收益。
* **缺点：** 价格数字会非常离谱（比如茅台的后复权价可能是几万元），和盘面价格对不上，不仅看着别扭，如果你的策略涉及到“价格档位”（如买入 1 手），需要重新换算。
* **适用场景：**
    * **严谨的统计计算：** 计算 5-10 年以上的长期相关性。
    * **算法交易：** 任何涉及 $\ln$（对数）或收益率计算的模型。

### 3. 具体分析场景的建议配置

为了避免踩坑，请参照下表选择复权方式：

| 分析角度 | 推荐复权方式 | 原因 |
| :--- | :--- | :--- |
| **计算相关系数 (Pearson/Spearman)** | **后复权 (推荐)** | 避免前复权可能出现的负值导致收益率无法计算；确保除权日的涨跌幅计算是真实的。 |
| **计算 Beta ($\beta$)** | **后复权 (推荐)** | Beta 依赖于收益率的协方差，必须保证长周期内的收益率连续且可算。 |
| **配对交易 (Pair Trading) / 协整** | **后复权 (强烈推荐)** | 配对交易通常涉及长周期的价差回归。前复权会导致历史价差比例严重失真，导致 Z-Score 计算错误。 |
| **画图展示 / 汇报 PPT** | **前复权** | 领导和客户更习惯看到“现在的价格”，用后复权画出几万块的股价会让人困惑。 |
| **日内高频分析 (Intraday)** | **不复权** (通常) | 日内分钟级数据通常不涉及除权问题，除非恰好跨越了除权日（极为罕见，通常隔夜处理）。 |

### 4. 一个容易被忽视的细节：除权日的处理

即使你使用了复权数据，还有一个细节会影响相关性——**除权日当天的涨跌幅计算**。

* **问题：** 很多数据源在除权日当天，虽然价格复权了，但“昨收盘”数据可能没对齐。
* **检查方法：** 手工检查一下标的 A 在除权日（Split Date）当天的收益率。
    * 如果是 0% 或正常波动（如 +1%），说明复权正确。
    * 如果是 -50% 或 +100%，说明复权算法有问题（数据源只改了今天的价格，没改昨天的历史），这必须剔除该样本，否则相关性计算全废。

### 总结
做两个标的的相关性分析：
1.  **严禁**使用不复权数据。
2.  **默认使用“后复权”**，这是计算收益率、相关性、Beta 最安全、最数学严谨的方式（因为它保证价格恒为正，且连续）。
3.  只有在**画图展示**给人类看的时候，才切换为**前复权**。


#### 价格的标准化方式 (Standardization)

由于两个标的的价格绝对值（例如：茅台 1800元 vs. 工商银行 5元）和波动率（例如：比特币 vs. 国债）通常完全不同，直接用原始价格（Raw Prices）做分析会有两个巨大陷阱：
1.  **量级偏差：** 价格高的标的会主导图表和协方差计算。
2.  **伪回归（Spurious Regression）：** 绝大多数资产价格都是“非平稳”的（一直涨或一直跌），直接做相关性分析容易得到极高的相关系数（比如 0.99），但实际上毫无逻辑联系。

你需要根据分析目的，选择以下 3 种标准化方式之一：

#### 1. 对数收益率 (Log Returns) —— **最推荐（做相关性计算时）**
这是金融统计中最标准的做法。它消除了价格量级的影响，且具有统计上的“平稳性”。
* **公式：** $R_t = \ln(P_t) - \ln(P_{t-1})$
* **适用场景：** 计算 Pearson/Spearman 相关系数、Granger 因果检验、波动率分析。
* **理由：** 我们关心的是“A涨1%时，B是否也涨1%”，而不是“A涨1块钱时，B是否涨1块钱”。

#### 2. 归一化/定基处理 (Rebasing / Indexing) —— **最推荐（画图对比时）**
将两个标的在起始日的价格都设为 100（或 1），后续价格按比例缩放。
* **公式：** $P_{norm} = (P_t / P_0) \times 100$
* **适用场景：** 直观展示累计收益率的走势对比（看图）。
* **理由：** 可以在同一张图的同一个左轴上，清晰地看到谁跑赢了谁。

#### 3. Z-Score 标准化 —— **最推荐（做配对交易/价差分析时）**
将数据转换为“偏离均值多少个标准差”。
* **公式：** $Z = (P_t - \mu) / \sigma$ （通常针对两者价差 Spread 进行此操作）
* **适用场景：** 均值回归策略、观察极端行情。
* **理由：** 不同资产的波动率不同。标的A跌 5% 可能很常见，但标的B跌 5% 可能是黑天鹅。Z-Score 能把它们拉到同一个风险维度衡量。

---

### 总结建议表

| 分析目的 | 推荐的**价格标准化**方式 | 推荐的**赋权**考虑 |
| :--- | :--- | :--- |
| **我要看两者是否同涨同跌** | **对数收益率 (Log Returns)** | 无需赋权 (1:1 比较) |
| **我要画图发报告给老板看** | **定基处理 (Start=100)** | 无需赋权 |
| **我要做配对交易(套利)** | **原始价格** (用于回归计算残差) | **Beta 对冲比率** (必须算，否则敞口不对) |
| **我要做风险组合** | **对数收益率** | **波动率倒数** (风险平价) |
| **市场剧烈波动时** | 同上 | **时间衰减赋权** (给近期数据更高权重) |

**简而言之：**
如果是做**统计研究**，请务必用 **Log Returns**；如果是做**实盘策略**，请务必计算 **Hedge Ratio ($\beta$)** 来确定仓位配比。

### 1. 线性与方向角度 (Linearity & Direction)
这是最基础的分析，判断两者是大体同向波动、反向波动，还是无关。

* **Pearson 相关系数：** 衡量线性的相关程度。
    * *应用：* 若系数接近 +1，说明两者几乎同涨同跌；接近 -1，说明由跷跷板效应（如美元与黄金有时呈负相关）。
* **Spearman 秩相关系数：** 衡量“排序”的相关性。
    * *应用：* 如果两个标的涨跌幅度不一致，但上涨的趋势（单调性）一致，这个指标比 Pearson 更准，能过滤掉极端值的影响。
* **Beta 系数 ($\beta$)：**
    * *应用：* 假设标的 A 是市场基准（如大盘），看标的 B 对 A 的敏感度。如果 $\beta > 1$，说明 B 的弹性比 A 大，A 涨 1%，B 可能涨 1.5%。

### 2. 长期均衡与均值回归角度 (Equilibrium & Cointegration)
**这是配对交易（Pairs Trading）的核心角度。** 两个标的短期可能背离，但长期是否有一根“看不见的绳子”把它们拉在一起？

* **协整检验 (Cointegration, e.g., Engle-Granger test)：**
    * *核心逻辑：* 即使两个标的各自都是随机游走（不确定性很高），但它们的线性组合（价差）可能是平稳的。
    * *比喻：* 就像醉汉遛狗。醉汉和狗各自的路线都乱七八糟（价格随机），但狗绳的长度是有限的，两者距离不会无限拉大（长期均衡）。
* **价差 (Spread) 与 Z-Score 分析：**
    * *应用：* 计算两者价格比率或差值的标准分（Z-Score）。当差值超过 2 个标准差时，预期会回归均值（Mean Reversion），是套利入场的时机。



### 3. 时间领先与因果角度 (Lead-Lag & Causality)
分析“谁先动，谁后动”。这对于通过一个标的来预测另一个标的至关重要。

* **Granger 因果检验 (Granger Causality)：**
    * *核心逻辑：* 不是真的哲学因果，而是“统计预测能力”。如果 A 的历史价格能显著提升对 B 未来价格的预测精度，则称 A Granger-leads B。
    * *应用：* 比如分析“美股半导体指数”是否领先于“台湾电子股指数”。
* **互相关函数 (Cross-Correlation Function, CCF)：**
    * *应用：* 检查在滞后 N 天的情况下，相关性是否达到峰值。比如发现 A 今天的走势与 B 两天后的走势相关性最高，说明 A 领先 B 两天。

### 4. 动态时变角度 (Dynamic & Time-Varying)
金融市场是瞬息万变的，过去的相关性不代表未来。相关性本身也是一个时间序列。

* **滚动相关性 (Rolling Correlation)：**
    * *应用：* 设定一个窗口（如 30 天），观察相关系数随时间的变化曲线。你可能会发现，在牛市时两者高度相关，但在熊市时相关性突然失效（Decoupling）。
* **DCC-GARCH 模型：**
    * *高阶应用：* 这是一种计量经济学模型，专门用来捕捉“随时间变化的波动率和相关性”。它能告诉你，当前的市场环境下，两者的联动关系是变紧了还是变松了。



### 5. 极端风险与尾部依赖角度 (Tail Dependence)
平常没事的时候两者可能不相关，但一旦发生股灾（黑天鹅），所有资产往往会同时下跌。

* **Copula 函数分析：**
    * *核心逻辑：* 把边缘分布和相关结构分开。
    * *应用：* 重点看**尾部相关性 (Tail Dependence)**。即：当标的 A 暴跌（处于分布的极左尾部）时，标的 B 暴跌的概率有多大？这对于风险控制至关重要，防止“分散投资失效”。

### 6. 基本面逻辑角度 (Fundamental Logic)
跳出数学统计，从业务逻辑去验证相关性。**没有逻辑支撑的统计相关性可能是“伪相关”。**

* **产业链逻辑：** 上游原材料 vs 下游成品（如：原油 vs 航空股，通常是成本反向关系；原油 vs 能源股，通常是同向关系）。
* **替代/互补逻辑：** 比如可口可乐 vs 百事可乐（竞争品，往往同涨同跌）；大豆 vs 豆粕（原料与产物）。
* **宏观驱动力：** 两者是否受同一个宏观因子驱动（如都对美联储加息敏感，或都受汇率影响）。

### 总结建议
如果你要进行分析，建议按以下步骤进行：
1.  **看图：** 把两个走势叠加（Normalize 到同一起点），直观感受。
2.  **算数：** 计算滚动相关系数，看稳定性。
3.  **找关系：** 做 Granger 检验看谁领先，做协整检验看能不能做套利。
4.  **防风险：** 思考极端行情下两者的联动逻辑。