基于您提到的 **“钱（资金）、时（时机）、货（标的）、退（风控）”** 核心框架，外加 **“费（磨损）”** 和 **“比（基准）”**，以下是设计一个专业量化定投回测程序所必须的完整输入要素列表。

这不仅仅是代码配置，更是您设计策略时必须填写的“作战计划书”。

---

### 一、 钱：资金管理输入 (Capital Inputs)
**核心目的：** 定义“弹药库”的结构，是存量博弈还是增量投入。

1.  **初始本金 (Initial Capital)**
    * *定义：* 账户最开始有的钱（如 100W）。
    * *作用：* 计算总收益率的分母，决定底仓大小。
2.  **追加资金流 (Cash Inflow)**
    * *定义：* (可选) 模拟工资定投，每期（月/年）额外注入账户的资金。
    * *细分项：*
        * `追加金额` (如：5000元/月)
        * `资金增长率` (如：每年增长 5%，模拟薪资涨幅)
3.  **闲置资金利率 (Risk-free Rate)**
    * *定义：* 账户里还没买入股票的现金，享受的年化理财收益（如 2.5%）。
    * *重要性：* **极其重要**。如果不算这个，定投策略在牛市会因为仓位不满而大幅跑输全仓买入。
4. **总投入资金量**
    * *定义* 一共可以投入的总量，投入资金量达到这个数量就终止定投


### 二、 时：回测周期与频率 (Time & Frequency Inputs)
**核心目的：** 划定战场范围和进攻节奏。

1.  **回测时间段 (Date Range)**
    * *输入：* `开始日期` (Start Date) 和 `结束日期` (End Date)。
    * *建议：* 至少覆盖一个完整的牛熊周期（如 5-7 年）。
    * *默认值：* 是最大值，即有数据开始
2.  **定投频率 (Frequency)**
    * *选项：* 按天 (Daily)、按周 (Weekly)、按月 (Monthly)。
3.  **具体的定投日 (Execution Day)**
    * *输入：* 如果是按月，是“每月第1个交易日”还是“每月倒数第1天”？
    * *细节：* 回测需处理非交易日（如定投日是周六，顺延到周一买，还是提前到周五买？）。

### 三、 货：投资标的数据 (Asset Inputs)
**核心目的：** 确定买什么，以及用什么数据来决策。

1.  **标的代码 (Symbol)**
    * *输入：* ETF 代码（如 `510300.SH`）或 指数代码（如 `000300.SH`），标的可以是股票，etf甚至是指数
2.  **价格数据模式 (Price Mode)**
    * *输入：* **强制选择“后复权” (Adjusted Close)**。
    * *原因：* 必须包含分红再投资的收益，否则 ETF 的长期收益会被严重低估。
3.  **估值数据源 (Valuation Data)**
    * *输入：* (可选，若做智能定投则必须) 标的对应的 **PE-TTM (滚动市盈率)** 或 **PB (市净率)** 历史序列。

### 四、 买：进场策略输入 (Entry Strategy Inputs)
**核心目的：** 决定每次买多少，是无脑买还是聪明买。

1.  **基准买入金额 (Base Amount)**
    * *输入：* 每次定投的标准金额（如 10000 元）。
2.  **策略类型 (Strategy Type)**
    * *选项：*
        * `普通定投` (DCA): 无论贵贱，固定金额买入。
        * `价值平均` (Value Averaging): 设定目标市值增长路径（稍微复杂，需填目标增长率）。
        * `智能变额` (Smart DCA): 根据估值/均线调整金额。
3.  **智能变额参数 (Smart Parameters)** (仅在选择智能定投时填写)
    * *参考指标：* 选 PE 分位数 或 均线偏离度。
    * *低估倍数：* 当极度便宜时，买基准的几倍？(如 2.0x)。
    * *高估倍数：* 当极度贵时，买基准的几倍？(如 0.5x 或 0.0x 暂停)。
    * *判断窗口：* 计算分位数参考过去多少天的数据？(建议 1250 天/5年)。

### 五、 退：止盈与风控输入 (Exit & Risk Inputs)
**核心目的：** 什么时候落袋为安，以及什么时候回来。

1.  **止盈模式 (Take Profit Mode)**
    * *选项：*
        * `无止盈` (长期持有)。
        * `目标收益止盈` (如赚 50% 就卖)，从1%开始，请注意每次再入场要重新计算可用总仓位，比如100W入场，第一次止盈变成了110W，那第二次入场总投入资金量就变成110W了，而不是100W
            - 持有仓位收益百分比，默认
            - 总仓位收益百分比
        * `移动回撤止盈` (Trailing Stop，推荐)。
2.  **移动止盈阈值 (Trailing Parameters)**
    * *激活线：* 收益率达到多少开始监控？(如 30%)。
    * *回撤线：* 从最高点回吐多少触发清仓？(如 8%)。
3.  **再入场机制 (Re-entry Logic)**
    * *输入：* 止盈清仓后，满足什么条件重启定投？
    * *选项：*
        * `时间触发`：空仓等待 N 天后
        * `空间触发`：标的从卖出价下跌 N% 后 (如 -15%)。

### 六、 费：磨损与细节 (Friction Inputs)
**核心目的：** 模拟真实世界的摩擦成本，避免回测虚高。

1.  **佣金费率 (Commission Rate)**
    * *输入：* 券商费率 (如 0.0001 / 万一)。，默认是万2.5
2.  **最低佣金 (Min Commission)**
    * *输入：* **关键项**。单笔交易最低收费 (如 5 元)。
    * *影响：* 决定了小额定投（如每天投 100 元）是否可行。
3.  **滑点 (Slippage)**
    * *输入：* 预估成交价劣势 (如 0.1%)。
    * *原因：* 定投通常按收盘价回测，但实盘可能买高了。

### 七、 比：基准对比 (Benchmark Inputs)
**核心目的：** 衡量策略是否真的有效。

1.  **对标策略 (Benchmark Strategy)**
    * *选项：*
        * `一次性买入` (Lump Sum): 假设第一天就把 100W 全买了。
        * `普通定投` (Plain DCA): 假设没有智能变额，只是固定定投。
    * *作用：* 计算相对收益 (Alpha)。如果你的智能策略跑不赢一次性买入，说明在那个时间段（可能是大牛市），囤现金是错误的。