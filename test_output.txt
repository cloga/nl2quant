D:\project\nl2quant\test\backtest_gem_option_strategy.py:344: FutureWarning: 'M' is deprecated and will be removed in a future version, please use 'ME' instead.
  monthly_data = self.price_data.resample('M').agg({
使用 Tushare 获取创业板指数数据...
Bull market days: 1957
开始回测...
初始资金: 100,000.00
回测期间: 2010-06-01 00:00:00 至 2025-12-08 00:00:00
============================================================
2010-06: 初始卖出10张认沽，权利金 17,160.53
2010-07: 认沽到期作废，继续卖出下月认沽
  → 权利金 18,077.38
2010-08: 认沽到期作废，继续卖出下月认沽
  → 权利金 9,571.99
2010-09: 认沽到期作废，继续卖出下月认沽
  → 权利金 17,594.06
2010-10: 认沽到期作废，继续卖出下月认沽
  → 权利金 19,871.08
2010-11: 认沽到期作废，继续卖出下月认沽
  → 权利金 11,027.37
2010-12: 认沽到期作废，继续卖出下月认沽
  → 权利金 10,618.18
2011-01: 认沽到期作废，继续卖出下月认沽
  → 权利金 19,210.24
2011-02: 认沽到期作废，继续卖出下月认沽
  → 权利金 20,529.15
2011-03: 认沽到期作废，继续卖出下月认沽
  → 权利金 9,410.76
2011-04: 认沽到期作废，继续卖出下月认沽
  → 权利金 17,037.35
2011-05: 认沽到期作废，继续卖出下月认沽
  → 权利金 15,797.88
2011-06: 认沽到期作废，继续卖出下月认沽
  → 权利金 15,447.28
2011-07: 认沽到期作废，继续卖出下月认沽
  → 权利金 nan
2011-08: 认沽到期作废，继续卖出下月认沽
  → 权利金 nan
2011-09: 认沽到期作废，继续卖出下月认沽
  → 权利金 nan
2011-10: 认沽到期作废，继续卖出下月认沽
  → 权利金 nan
2011-11: 认沽到期作废，继续卖出下月认沽
  → 权利金 nan
2011-12: 认沽到期作废，继续卖出下月认沽
  → 权利金 nan
2012-01: 认沽到期作废，继续卖出下月认沽
  → 权利金 nan
2012-02: 认沽到期作废，继续卖出下月认沽
  → 权利金 nan
2012-03: 认沽到期作废，继续卖出下月认沽
  → 权利金 nan
2012-04: 认沽到期作废，继续卖出下月认沽
  → 权利金 nan
2012-05: 认沽到期作废，继续卖出下月认沽
  → 权利金 nan
2012-06: 认沽到期作废，继续卖出下月认沽
  → 权利金 nan
2012-07: 认沽到期作废，继续卖出下月认沽
  → 权利金 nan
2012-08: 认沽到期作废，继续卖出下月认沽
  → 权利金 nan
2012-09: 认沽到期作废，继续卖出下月认沽
  → 权利金 14,233.54
2012-10: 认沽到期作废，继续卖出下月认沽
  → 权利金 nan
2012-11: 认沽到期作废，继续卖出下月认沽
  → 权利金 nan
2012-12: 认沽到期作废，继续卖出下月认沽
  → 权利金 6,662.72
2013-01: 认沽到期作废，继续卖出下月认沽
  → 权利金 7,242.71
2013-02: 认沽到期作废，继续卖出下月认沽
  → 权利金 8,036.89
2013-03: 认沽到期作废，继续卖出下月认沽
  → 权利金 16,173.83
2013-04: 认沽到期作废，继续卖出下月认沽
  → 权利金 16,601.78
2013-05: 认沽到期作废，继续卖出下月认沽
  → 权利金 20,029.76
2013-06: 认沽到期作废，继续卖出下月认沽
  → 权利金 18,884.28
2013-07: 认沽到期作废，继续卖出下月认沽
  → 权利金 21,168.28
2013-08: 认沽到期作废，继续卖出下月认沽
  → 权利金 11,061.35
2013-09: 认沽到期作废，继续卖出下月认沽
  → 权利金 25,534.36
2013-10: 认沽到期作废，继续卖出下月认沽
  → 权利金 23,063.69
2013-11: 认沽到期作废，继续卖出下月认沽
  → 权利金 25,514.23
2013-12: 认沽到期作废，继续卖出下月认沽
  → 权利金 24,349.62
2014-01: 认沽到期作废，继续卖出下月认沽
  → 权利金 13,962.46
2014-02: 认沽到期作废，继续卖出下月认沽
  → 权利金 26,784.69
2014-03: 认沽到期作废，继续卖出下月认沽
  → 权利金 24,785.60
2014-04: 认沽到期作废，继续卖出下月认沽
  → 权利金 23,953.23
2014-05: 认沽到期作废，继续卖出下月认沽
  → 权利金 24,605.04
2014-06: 认沽到期作废，继续卖出下月认沽
  → 权利金 13,110.63
2014-07: 认沽到期作废，继续卖出下月认沽
  → 权利金 12,549.08
2014-08: 认沽到期作废，继续卖出下月认沽
  → 权利金 26,590.09
2014-09: 认沽到期作废，继续卖出下月认沽
  → 权利金 28,762.98
2014-10: 认沽到期作废，继续卖出下月认沽
  → 权利金 14,123.83
2014-11: 认沽到期作废，继续卖出下月认沽
  → 权利金 14,661.28
2014-12: 认沽到期作废，继续卖出下月认沽
  → 权利金 13,736.46
2015-01: 认沽到期作废，继续卖出下月认沽
  → 权利金 15,685.41
2015-02: 认沽到期作废，继续卖出下月认沽
  → 权利金 35,990.15
2015-03: 认沽到期作废，继续卖出下月认沽
  → 权利金 21,794.93
2015-04: 认沽到期作废，继续卖出下月认沽
  → 权利金 53,347.28
2015-05: 认沽到期作废，继续卖出下月认沽
  → 权利金 33,066.54
2015-06: 认沽被行权，接入 10000 股，成本价 3188.56
  → 立即卖出 100 张认购，行权价 3507.42，权利金 26,680.32
2015-07: 认购到期作废，继续卖认购，权利金 23,705.21
2015-08: 认购到期作废，继续卖认购，权利金 21,858.24
2015-09: 认购到期作废，继续卖认购，权利金 nan
2015-10: 认购到期作废，继续卖认购，权利金 23,130.59
2015-11: 认购到期作废，继续卖认购，权利金 24,944.09
2015-12: 认购到期作废，继续卖认购，权利金 25,331.11
2016-01: 认购到期作废，继续卖认购，权利金 23,251.57
2016-02: 认购到期作废，继续卖认购，权利金 nan
2016-03: 认购到期作废，继续卖认购，权利金 nan
2016-04: 认购到期作废，继续卖认购，权利金 nan
2016-05: 认购到期作废，继续卖认购，权利金 nan
2016-06: 认购到期作废，继续卖认购，权利金 nan
2016-07: 认购到期作废，继续卖认购，权利金 nan
2016-08: 认购到期作废，继续卖认购，权利金 nan
2016-09: 认购到期作废，继续卖认购，权利金 nan
2016-10: 认购到期作废，继续卖认购，权利金 nan
2016-11: 认购到期作废，继续卖认购，权利金 nan
2016-12: 认购到期作废，继续卖认购，权利金 nan
2017-01: 认购到期作废，继续卖认购，权利金 nan
2017-02: 认购到期作废，继续卖认购，权利金 nan
2017-03: 认购到期作废，继续卖认购，权利金 nan
2017-04: 认购到期作废，继续卖认购，权利金 nan
2017-05: 认购到期作废，继续卖认购，权利金 nan
2017-06: 认购到期作废，继续卖认购，权利金 nan
2017-07: 认购到期作废，继续卖认购，权利金 nan
2017-08: 认购到期作废，继续卖认购，权利金 nan
2017-09: 认购到期作废，继续卖认购，权利金 nan
2017-10: 认购到期作废，继续卖认购，权利金 17,833.40
2017-11: 认购到期作废，继续卖认购，权利金 17,702.73
2017-12: 认购到期作废，继续卖认购，权利金 nan
2018-01: 认购到期作废，继续卖认购，权利金 nan
2018-02: 认购到期作废，继续卖认购，权利金 nan
2018-03: 认购到期作废，继续卖认购，权利金 17,737.83
2018-04: 认购到期作废，继续卖认购，权利金 16,852.23
2018-05: 认购到期作废，继续卖认购，权利金 17,158.43
2018-06: 认购到期作废，继续卖认购，权利金 nan
2018-07: 认购到期作废，继续卖认购，权利金 nan
2018-08: 认购到期作废，继续卖认购，权利金 nan
2018-09: 认购到期作废，继续卖认购，权利金 nan
2018-10: 认购到期作废，继续卖认购，权利金 nan
2018-11: 认购到期作废，继续卖认购，权利金 nan
2018-12: 认购到期作废，继续卖认购，权利金 nan
2019-01: 认购到期作废，继续卖认购，权利金 nan
2019-02: 认购到期作废，继续卖认购，权利金 14,333.02
2019-03: 认购到期作废，继续卖认购，权利金 15,806.44
2019-04: 认购到期作废，继续卖认购，权利金 15,155.30
2019-05: 认购到期作废，继续卖认购，权利金 13,847.47
2019-06: 认购到期作废，继续卖认购，权利金 14,107.40
2019-07: 认购到期作废，继续卖认购，权利金 14,657.01
2019-08: 认购到期作废，继续卖认购，权利金 15,035.05
2019-09: 认购到期作废，继续卖认购，权利金 15,190.42
2019-10: 认购到期作废，继续卖认购，权利金 15,598.91
2019-11: 认购到期作废，继续卖认购，权利金 15,539.03
2019-12: 认购到期作废，继续卖认购，权利金 16,782.44
2020-01: 认购到期作废，继续卖认购，权利金 17,992.26
2020-02: 认购到期作废，继续卖认购，权利金 19,334.62
2020-03: 认购到期作废，继续卖认购，权利金 17,471.23
2020-04: 认购到期作废，继续卖认购，权利金 19,314.70
2020-05: 认购到期作废，继续卖认购，权利金 19,475.55
2020-06: 认购到期作废，继续卖认购，权利金 22,756.50
2020-07: 认购到期作废，继续卖认购，权利金 26,090.40
2020-08: 认购到期作废，继续卖认购，权利金 25,464.26
2020-09: 认购到期作废，继续卖认购，权利金 24,031.08
2020-10: 认购到期作废，继续卖认购，权利金 24,788.07
2020-11: 认购到期作废，继续卖认购，权利金 24,564.30
2020-12: 认购到期作废，继续卖认购，权利金 27,685.06
2021-01: 认购到期作废，继续卖认购，权利金 29,202.74
2021-02: 认购到期作废，继续卖认购，权利金 27,198.39
2021-03: 认购到期作废，继续卖认购，权利金 25,746.01
2021-04: 认购到期作废，继续卖认购，权利金 28,853.02
2021-05: 认购到期作废，继续卖认购，权利金 61,769.29
2021-06: 认购到期作废，继续卖认购，权利金 97,360.98
2021-07: 认购到期作废，继续卖认购，权利金 96,325.09
2021-08: 认购到期作废，继续卖认购，权利金 59,996.85
2021-09: 认购到期作废，继续卖认购，权利金 60,566.72
2021-10: 认购到期作废，继续卖认购，权利金 93,818.62
2021-11: 认购到期作废，继续卖认购，权利金 97,876.59
2021-12: 认购到期作废，继续卖认购，权利金 62,023.22
2022-01: 认购到期作废，继续卖认购，权利金 60,669.63
2022-02: 认购到期作废，继续卖认购，权利金 nan
2022-03: 认购到期作废，继续卖认购，权利金 nan
2022-04: 认购到期作废，继续卖认购，权利金 nan
D:\project\nl2quant\test\backtest_gem_option_strategy.py:466: FutureWarning: The default fill_method='pad' in Series.pct_change is deprecated and will be removed in a future version. Either fill in any non-leading NA values prior to calling pct_change or specify 'fill_method=None' to not fill NA values.
  monthly_returns = equity_series.pct_change().dropna()
2022-05: 认购到期作废，继续卖认购，权利金 nan
2022-06: 认购到期作废，继续卖认购，权利金 nan
2022-07: 认购到期作废，继续卖认购，权利金 nan
2022-08: 认购到期作废，继续卖认购，权利金 nan
2022-09: 认购到期作废，继续卖认购，权利金 nan
2022-10: 认购到期作废，继续卖认购，权利金 nan
2022-11: 认购到期作废，继续卖认购，权利金 nan
2022-12: 认购到期作废，继续卖认购，权利金 nan
2023-01: 认购到期作废，继续卖认购，权利金 24,087.83
2023-02: 认购到期作废，继续卖认购，权利金 23,773.84
2023-03: 认购到期作废，继续卖认购，权利金 nan
2023-04: 认购到期作废，继续卖认购，权利金 nan
2023-05: 认购到期作废，继续卖认购，权利金 nan
2023-06: 认购到期作废，继续卖认购，权利金 nan
2023-07: 认购到期作废，继续卖认购，权利金 nan
2023-08: 认购到期作废，继续卖认购，权利金 nan
2023-09: 认购到期作废，继续卖认购，权利金 nan
2023-10: 认购到期作废，继续卖认购，权利金 nan
2023-11: 认购到期作废，继续卖认购，权利金 nan
2023-12: 认购到期作废，继续卖认购，权利金 nan
2024-01: 认购到期作废，继续卖认购，权利金 nan
2024-02: 认购到期作废，继续卖认购，权利金 nan
2024-03: 认购到期作废，继续卖认购，权利金 nan
2024-04: 认购到期作废，继续卖认购，权利金 nan
2024-05: 认购到期作废，继续卖认购，权利金 nan
2024-06: 认购到期作废，继续卖认购，权利金 nan
2024-07: 认购到期作废，继续卖认购，权利金 nan
2024-08: 认购到期作废，继续卖认购，权利金 nan
2024-09: 认购到期作废，继续卖认购，权利金 20,300.81
2024-10: 认购到期作废，继续卖认购，权利金 20,201.64
2024-11: 认购到期作废，继续卖认购，权利金 20,757.36
2024-12: 认购到期作废，继续卖认购，权利金 19,988.23
2025-01: 认购到期作废，继续卖认购，权利金 19,262.32
2025-02: 认购到期作废，继续卖认购，权利金 20,256.99
2025-03: 认购到期作废，继续卖认购，权利金 19,634.52
2025-04: 认购到期作废，继续卖认购，权利金 18,192.18
2025-05: 认购到期作废，继续卖认购，权利金 18,603.09
2025-06: 认购到期作废，继续卖认购，权利金 20,094.79
2025-07: 认购到期作废，继续卖认购，权利金 21,730.92
2025-08: 认购到期作废，继续卖认购，权利金 26,974.50
2025-09: 认购到期作废，继续卖认购，权利金 60,445.66
2025-10: 认购到期作废，继续卖认购，权利金 29,750.31
2025-11: 认购到期作废，继续卖认购，权利金 28,490.81
2025-12: 认购到期作废，继续卖认购，权利金 59,551.68

============================================================
回测报告
============================================================

总收益率: nan%
年化收益率: nan%
最大回撤: 0.00%
夏普比率: 0.36

累计权利金收入: nan
最终权益: nan
最大资金占用: 31,885,596.00
建议准备资金倍数: 318.9x

交易统计:
  认沽被行权: 1 次
  认沽到期作废: 59 次
  认购被行权: 0 次
  移仓次数: 0 次
  胜率（收权利金）: 98.3%

详细数据已保存:
  权益曲线: d:/project/nl2quant/test/option_strategy_equity.csv
  交易记录: d:/project/nl2quant/test/option_strategy_trades.csv
Daily equity records: 186
Columns: ['date', 'cash', 'stock_value', 'total_equity', 'stock_position', 'premium_received']
First 5 rows:
        date           cash  ...  stock_position  premium_received
0 2010-07-31  135237.906667  ...               0      35237.906667
1 2010-08-31  144809.893333  ...               0      44809.893333
2 2010-09-30  162403.954667  ...               0      62403.954667
3 2010-10-31  182275.032000  ...               0      82275.032000
4 2010-11-30  193302.402667  ...               0      93302.402667

[5 rows x 6 columns]
Last 5 rows:
          date  cash  ...  stock_position  premium_received
181 2025-08-31   NaN  ...           10000               NaN
182 2025-09-30   NaN  ...           10000               NaN
183 2025-10-31   NaN  ...           10000               NaN
184 2025-11-30   NaN  ...           10000               NaN
185 2025-12-31   NaN  ...           10000               NaN

[5 rows x 6 columns]
Total equity not nan: 12
